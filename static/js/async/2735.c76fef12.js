"use strict";(self.webpackChunknote=self.webpackChunknote||[]).push([["2735"],{2316:function(e,n,r){r.r(n),r.d(n,{default:()=>i});var s=r(5893),d=r(65);function l(e){let n=Object.assign({h1:"h1",a:"a",p:"p",code:"code",ul:"ul",li:"li",h2:"h2",pre:"pre",blockquote:"blockquote",strong:"strong",ol:"ol"},(0,d.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.h1,{id:"模块",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#模块",children:"#"}),"模块"]}),"\n",(0,s.jsxs)(n.p,{children:["模块(",(0,s.jsx)(n.code,{children:"Module"}),")是自动运行在严格模式下并且没有办法退出运行的",(0,s.jsx)(n.code,{children:"JavaScript"}),"代码。"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"模块的代码自动运行在严格模式下"}),"\n",(0,s.jsxs)(n.li,{children:["模块的顶部，",(0,s.jsx)(n.code,{children:"this"}),"的值是",(0,s.jsx)(n.code,{children:"undefined"})]}),"\n"]}),"\n",(0,s.jsxs)(n.h2,{id:"导出语法",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#导出语法",children:"#"}),"导出语法"]}),"\n",(0,s.jsxs)(n.p,{children:["可以用",(0,s.jsx)(n.code,{children:"export"}),"关键字将任意变量、函数或类声明从模块中导出。除非用",(0,s.jsx)(n.code,{children:"default"}),"关键字，否则不能用",(0,s.jsx)(n.code,{children:"export"}),"导出匿名函数或类"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"export const color = 'red'\n\nfunction multiply(factor, faciend){\n    return factor * faciend\n}\n\nexport multiply\n"})}),"\n",(0,s.jsxs)(n.h2,{id:"导入语法",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#导入语法",children:"#"}),"导入语法"]}),"\n",(0,s.jsxs)(n.p,{children:["模块的导出可以通过",(0,s.jsx)(n.code,{children:"import"}),"关键字在另一个模块中访问。"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"import {color, multiply} from './example.js'\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"import"}),"后面的大括号表示从给定模块导入的绑定(binding)。"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"导入绑定的列表看起来和解构对象很像，但它不是"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["关键字",(0,s.jsx)(n.code,{children:"from"}),"表示从哪个模块导入。由表示模块路径的字符串指定。"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["浏览器使用的路径格式与传给",(0,s.jsx)(n.code,{children:"<script>"}),"元素的相同，必须加上扩展名"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Node.js"}),"则遵循基于文件系统前缀区分本地文件和包的习惯"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["从模块中导入的绑定，和常量",(0,s.jsx)(n.code,{children:"const"}),"类似，不能存在同名变量，也无法在",(0,s.jsx)(n.code,{children:"import"}),"语句前使用标识符或改变绑定的值"]}),"\n",(0,s.jsxs)(n.p,{children:["可以使用",(0,s.jsx)(n.code,{children:"as"}),"关键字将整个模块作为一个单一对象导入。该模块的所有导出都可以作为对象的属性使用。"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"import * as example from './example.js'\n\nconsole.log(example.multiply(1, 2)) // 2\n"})}),"\n",(0,s.jsxs)(n.p,{children:["一个模块不管被",(0,s.jsx)(n.code,{children:"import"}),"了几次，都只执行一次。"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"export"}),"和",(0,s.jsx)(n.code,{children:"import"}),"的一个重要限制是",(0,s.jsx)(n.strong,{children:"必须在其他语句和函数之外使用"})]}),"\n",(0,s.jsxs)(n.h2,{id:"导出和导入时重命名",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#导出和导入时重命名",children:"#"}),"导出和导入时重命名"]}),"\n",(0,s.jsxs)(n.p,{children:["当导入或者导出变量、函数或者类时，可以用",(0,s.jsx)(n.code,{children:"as"}),"关键字改变名称。"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"import {color as copiedColor} from './example.js' // 不能用解构赋值语法 import {color: copiedColor} from './example.js'\n\nfunction sum(a, b){\n    return a + b\n}\n\nexport {\n    sum as add\n}\n"})}),"\n",(0,s.jsxs)(n.h2,{id:"模块的默认值",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#模块的默认值",children:"#"}),"模块的默认值"]}),"\n",(0,s.jsxs)(n.p,{children:["模块的默认值是指通过",(0,s.jsx)(n.code,{children:"default"}),"关键字指定的单个变量、函数或类。只能为每个模块设置一个默认导出值。"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"export const name = 'Mike'\nexport default function (a, b){\n    return a + b\n}\n\n// 另一个模块\nimport add, {name} from './add.js'\n"})}),"\n",(0,s.jsx)(n.p,{children:"另外还可以通过重命名来导出默认值，上例可以改成："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"const name = 'Mike'\nfunction add (a, b){\n    return a + b\n}\nexport {\n    add as default,\n    name\n}\n\n// 另一个模块\nimport {\n    default as add,\n    name\n} from './add.js'\n"})}),"\n",(0,s.jsxs)(n.h2,{id:"重新导出一个绑定",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#重新导出一个绑定",children:"#"}),"重新导出一个绑定"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"export * from './example.js'\nexport {\n    default as add,\n    name\n} from './add.js'\n"})}),"\n",(0,s.jsxs)(n.h2,{id:"加载模块",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#加载模块",children:"#"}),"加载模块"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"ES6"}),"定义了模块语法，但是并没有定义如何加载这些模块。加载机制由一个未定义的内部抽象方法",(0,s.jsx)(n.code,{children:"HostResolveImportedModule"}),"决定，浏览器和",(0,s.jsx)(n.code,{children:"Node.js"}),"可以自己实现。"]}),"\n",(0,s.jsxs)(n.p,{children:["在",(0,s.jsx)(n.code,{children:"<script>"}),"中将",(0,s.jsx)(n.code,{children:"type"}),"设置为",(0,s.jsx)(n.code,{children:"module"}),"时，支持加载模块。为了保证模块的加载顺序，",(0,s.jsx)(n.code,{children:'<script type="module">'}),"在执行时，自动应用",(0,s.jsx)(n.code,{children:"defer"}),"属性。因此，所以的模块组件在文档被解析完才会执行。"]}),"\n",(0,s.jsx)(n.p,{children:"由于每个模块都可以从其他模块导入，因此在加载阶段，该模块加载完之后会识别所有导入语句，然后每个导入语句都出发一次获取过程，并且在所有导入资源都被加载之后，执行当前模块。"}),"\n",(0,s.jsx)(n.p,{children:"以如下代码为例："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'\x3c!-- 先执行这个标签 --\x3e\n<script type="module" src="module1.js"><\/script>\n\x3c!-- 再执行这个标签 --\x3e\n<script type="module">\nimport {multiply} from \'./example.js\'\n\nconst result = multiply(1, 3)\n<\/script>\n\x3c!-- 最后执行这个标签 --\x3e\n<script type="module" src="module2.js"><\/script>\n'})}),"\n",(0,s.jsx)(n.p,{children:"完整的加载顺序如下："}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["下载并解析",(0,s.jsx)(n.code,{children:"module1.js"})]}),"\n",(0,s.jsxs)(n.li,{children:["递归下载并解析",(0,s.jsx)(n.code,{children:"module1.js"}),"中导入的模块"]}),"\n",(0,s.jsx)(n.li,{children:"解析内联模块"}),"\n",(0,s.jsx)(n.li,{children:"递归下载并解析内联模块中导入的模块"}),"\n",(0,s.jsxs)(n.li,{children:["下载并解析",(0,s.jsx)(n.code,{children:"module2.js"})]}),"\n",(0,s.jsxs)(n.li,{children:["递归下载并解析",(0,s.jsx)(n.code,{children:"module2.js"}),"中导入的模块"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"加载完成之后，只有当文档完全被解析之后才会执行以下操作："}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["递归执行",(0,s.jsx)(n.code,{children:"module1.js"}),"中导入的模块"]}),"\n",(0,s.jsxs)(n.li,{children:["执行",(0,s.jsx)(n.code,{children:"module1.js"})]}),"\n",(0,s.jsx)(n.li,{children:"递归执行内联模块中导入的模块"}),"\n",(0,s.jsx)(n.li,{children:"执行内联模块"}),"\n",(0,s.jsxs)(n.li,{children:["递归执行",(0,s.jsx)(n.code,{children:"module2.js"}),"中导入的模块"]}),"\n",(0,s.jsxs)(n.li,{children:["执行",(0,s.jsx)(n.code,{children:"module2.js"})]}),"\n"]}),"\n",(0,s.jsxs)(n.h2,{id:"异步模块加载",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#异步模块加载",children:"#"}),"异步模块加载"]}),"\n",(0,s.jsxs)(n.p,{children:["与通用脚本加载一样，模块也支持",(0,s.jsx)(n.code,{children:"async"}),"属性，设置之后，会以异步方式加载。异步加载的模块不必等待文档解析完成，但是需要模块中所有导入文件都加载完成，才会执行模块。但是无法保证模块的先后执行顺序，而是哪个模块及其依赖模块先加载完就先执行哪个模块。"]}),"\n",(0,s.jsxs)(n.h2,{id:"将模块作为worker加载",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#将模块作为worker加载",children:"#"}),"将模块作为",(0,s.jsx)(n.code,{children:"Worker"}),"加载"]}),"\n",(0,s.jsxs)(n.p,{children:["通过配置",(0,s.jsx)(n.code,{children:"Worker"}),"的第二个参数，可以支持以模块方式加载。"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"const worker = new Worker('script.js') // 创建的Worker以脚本方式加载\n\nconst moduleWorker = new Worker('module.js', {type: 'module'}) // 创建的Worker以模块方式加载\n"})}),"\n",(0,s.jsxs)(n.p,{children:["以脚本方式加载的",(0,s.jsx)(n.code,{children:"Worker"}),"与以模块方式加载的",(0,s.jsx)(n.code,{children:"Worker"}),"存在以下两点不同："]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Worker"}),"脚本只能引用与网页同源的",(0,s.jsx)(n.code,{children:"JavaScript"}),"，而",(0,s.jsx)(n.code,{children:"Worker"}),"模块不会完全受限，可以加载并访问具有适当的跨域资源共享(CORS)头的文件。"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Worker"}),"脚本可以使用",(0,s.jsx)(n.code,{children:"self.importScripts()"}),"加载其他脚本，但",(0,s.jsx)(n.code,{children:"Worker"}),"模块不能，而是应该使用",(0,s.jsx)(n.code,{children:"import"}),"来导入。"]}),"\n"]}),"\n",(0,s.jsxs)(n.h2,{id:"浏览器模块说明符解析",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#浏览器模块说明符解析",children:"#"}),"浏览器模块说明符解析"]}),"\n",(0,s.jsxs)(n.p,{children:["在浏览器中，模块说明符(",(0,s.jsx)(n.code,{children:"module specifier"}),")只支持以下四种格式："]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["以",(0,s.jsx)(n.code,{children:"/"}),"开头，从根目录开始解析"]}),"\n",(0,s.jsxs)(n.li,{children:["以",(0,s.jsx)(n.code,{children:"./"}),"开头，从当前目录开始解析"]}),"\n",(0,s.jsxs)(n.li,{children:["以",(0,s.jsx)(n.code,{children:"../"}),"开头，从父级目录开始解析"]}),"\n",(0,s.jsx)(n.li,{children:"URL格式，不同源时，需要正确配置跨域(CORS)"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"以下的格式，是无效的，并且会导致错误"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"import {multiply} from 'example.js'\n"})}),"\n",(0,s.jsxs)(n.h2,{id:"es-modules进阶",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#es-modules进阶",children:"#"}),"ES Modules进阶"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://www.yuque.com/xixiaobai/xomql8/ironhk#eSVOy",rel:"noopener noreferrer",target:"_blank",children:"精读《snowpack和vite》-ESM"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://segmentfault.com/a/1190000014318751",rel:"noopener noreferrer",target:"_blank",children:"图说 ES Modules"})}),"\n"]})]})}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,d.ah)(),e.components);return n?(0,s.jsx)(n,Object.assign({},e,{children:(0,s.jsx)(l,e)})):l(e)}let i=c;c.__RSPRESS_PAGE_META={},c.__RSPRESS_PAGE_META["javascript%2Fes6%2Fmodule.md"]={toc:[{id:"导出语法",text:"导出语法",depth:2},{id:"导入语法",text:"导入语法",depth:2},{id:"导出和导入时重命名",text:"导出和导入时重命名",depth:2},{id:"模块的默认值",text:"模块的默认值",depth:2},{id:"重新导出一个绑定",text:"重新导出一个绑定",depth:2},{id:"加载模块",text:"加载模块",depth:2},{id:"异步模块加载",text:"异步模块加载",depth:2},{id:"将模块作为worker加载",text:"将模块作为`Worker`加载",depth:2},{id:"浏览器模块说明符解析",text:"浏览器模块说明符解析",depth:2},{id:"es-modules进阶",text:"ES Modules进阶",depth:2}],title:"模块",headingTitle:"模块",frontmatter:{}}}}]);